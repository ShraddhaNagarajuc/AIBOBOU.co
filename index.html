<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>AIBOBOU AAP KI AWAAZ LIST</title>

    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 25px;
            background: #fafafa;
        }
        h2 {
            margin-bottom: 15px;
        }

        .controls {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        input, select, button {
            padding: 8px;
            font-size: 15px;
        }

        button {
            background: #0057ff;
            color: white;
            border: none;
            cursor: pointer;
            border-radius: 5px;
        }

        button:hover {
            background: #003fb8;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
        }
        th, td {
            padding: 12px;
            border: 1px solid #d9d9d9;
            text-align: left;
        }
        th {
            background: #e9f1ff;
        }
        tr:hover {
            background: #f4f8ff;
        }
        a {
            color: #0057ff;
            text-decoration: none;
            font-weight: 600;
        }
        a:hover {
            text-decoration: underline;
        }

        td.date-cell {
            white-space: nowrap;
            width: 140px;
        }
    </style>
</head>

<body>

<h2>AIBOBOU AAP KI AWAAZ LIST</h2>

<!-- FILTER CONTROLS -->
<div class="controls">
    <input type="text" id="searchBox" placeholder="Search description...">

    <select id="categoryFilter">
        <option value="">All Categories</option>
    </select>

    <input type="date" id="dateFilter">
    
    <button onclick="clearFilters()">Clear Filters</button>
</div>

<!-- TABLE -->
<table>
    <thead>
        <tr>
            <th>Sr.No</th>
            <th>Date</th>
            <th>Description</th>
            <th>Category</th>
        </tr>
    </thead>
    <tbody id="tableBody"></tbody>
</table>

<script>
    const endpoint =
        "https://script.google.com/macros/s/AKfycbwlHJE4IVzQCZIedoMpw0yJxnKgK90iFYAU4mXkyo_P036ic_1Flu-1JK8nCFbliL-jnQ/exec";

    let globalData = [];

    // Load data from Apps Script
    async function load() {
        const res = await fetch(endpoint);
        const data = await res.json();
        globalData = data;

        // Fill category dropdown
        const catDropdown = document.getElementById("categoryFilter");
        const categories = [...new Set(data.map(x => x.category).filter(Boolean))];

        categories.forEach(cat => {
            const opt = document.createElement("option");
            opt.value = cat;
            opt.textContent = cat;
            catDropdown.appendChild(opt);
        });

        render();

        document.getElementById("searchBox").onkeyup = render;
        document.getElementById("categoryFilter").onchange = render;
        document.getElementById("dateFilter").onchange = render;
    }

    // Render table based on filters
    function render() {
        const searchText = document.getElementById("searchBox").value.toLowerCase();
        const catFilter = document.getElementById("categoryFilter").value;
        const dateFilter = document.getElementById("dateFilter").value;

        const tbody = document.getElementById("tableBody");
        tbody.innerHTML = "";

        globalData
            .filter(r =>
                r.description.toLowerCase().includes(searchText) &&
                (catFilter === "" || r.category === catFilter) &&
                (dateFilter === "" || r.date === formatDate(dateFilter))
            )
            .forEach(r => {
                const tr = document.createElement("tr");
                const hasLink = r.link && r.link.trim() !== "";

                tr.innerHTML = `
                    <td>${r.srno}</td>
                    <td class="date-cell">${r.date}</td>
                    <td>
                        ${hasLink
                            ? `<a href="${r.link}" target="_blank">${r.description}</a>`
                            : `${r.description}`
                        }
                    </td>
                    <td>${r.category}</td>
                `;

                tbody.appendChild(tr);
            });
    }

    // Clear all filters
    function clearFilters() {
        document.getElementById("searchBox").value = "";
        document.getElementById("categoryFilter").value = "";
        document.getElementById("dateFilter").value = "";
        render();
    }

    // Convert YYYY-MM-DD â†’ DD-MM-YYYY (matches sheet)
    function formatDate(d) {
        if (!d) return "";
        const [y, m, day] = d.split("-");
        return `${Number(day)}-${Number(m)}-${y}`;
    }

    load();
</script>

</body>
</html>
