<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>AIBOBOU AAP KI AWAAZ LIST</title>

    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 25px;
            background: #fafafa;
        }

        h2 {
            margin-bottom: 20px;
            font-size: 26px;
        }

        .controls {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            align-items: center;
        }

        input,
        .dropdown-box,
        button {
            padding: 8px;
            font-size: 15px;
        }

        .dropdown-box {
            width: 150px;
            background: white;
            border: 1px solid #ccc;
            cursor: pointer;
            border-radius: 4px;
        }

        /* CATEGORY DROPDOWN CLEAN UI */
        .category-dropdown {
            position: absolute;
            background: white;
            border: 1px solid #ccc;
            padding: 10px;
            margin-top: 5px;
            width: 230px;
            max-height: 250px;
            overflow-y: auto;
            display: none;
            z-index: 1000;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.15);
            border-radius: 6px;
        }

        .category-option {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 6px 0;
            white-space: nowrap;
        }

        .category-option input[type="checkbox"] {
            transform: scale(1.1);
            cursor: pointer;
        }

        .category-option label {
            cursor: pointer;
            font-size: 14px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
        }

        th,
        td {
            padding: 12px;
            border: 1px solid #d9d9d9;
            text-align: left;
        }

        th {
            background: #e9f1ff;
            font-size: 15px;
        }

        td.date-cell {
            white-space: nowrap;
            width: 130px;
        }

        tr:hover {
            background: #f4f8ff;
        }

        /* Tooltip */
        .tooltip {
            position: relative;
            cursor: pointer;
        }

        .tooltip:hover::after {
            content: "Click to view";
            position: absolute;
            top: -28px;
            left: 0;
            background: black;
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            white-space: nowrap;
        }
    </style>
</head>

<body>

    <h2>AIBOBOU AAP KI AWAAZ LIST</h2>

    <div class="controls">

        <input type="text" id="searchBox" placeholder="Search description…" style="width:200px;">

        <div>
            <div id="categoryBox" class="dropdown-box">Category ▾</div>

            <div id="categoryDropdown" class="category-dropdown">
                <div class="category-option">
                    <input type="checkbox" value="Transfer Related">
                    <label>Transfer Related</label>
                </div>
                <div class="category-option">
                    <input type="checkbox" value="Promotions Related">
                    <label>Promotions Related</label>
                </div>
                <div class="category-option">
                    <input type="checkbox" value="Operational Issues">
                    <label>Operational Issues</label>
                </div>
                <div class="category-option">
                    <input type="checkbox" value="Staff Welfare Measures">
                    <label>Staff Welfare Measures</label>
                </div>
                <div class="category-option">
                    <input type="checkbox" value="Staffing Related">
                    <label>Staffing Related</label>
                </div>
                <div class="category-option">
                    <input type="checkbox" value="HR Related issues">
                    <label>HR Related issues</label>
                </div>
                <div class="category-option">
                    <input type="checkbox" value="Staff Accountability and disciplinary Policy">
                    <label>Staff Accountability and disciplinary Policy</label>
                </div>
                <div class="category-option">
                    <input type="checkbox" value="Miscelleneous">
                    <label>Miscelleneous</label>
                </div>
            </div>
        </div>

        <input type="text" id="dateInput" placeholder="Enter date" style="width:150px;">

        <button onclick="clearFilters()">Clear Filters</button>

    </div>

    <table>
        <thead>
            <tr>
                <th>Sr.No</th>
                <th>Date</th>
                <th>Description</th>
                <th>Category</th>
            </tr>
        </thead>
        <tbody id="tableBody"></tbody>
    </table>

    <script>
        const endpoint = "https://script.google.com/macros/s/AKfycbwlHJE4IVzQCZIedoMpw0yJxnKgK90iFYAU4mXkyo_P036ic_1Flu-1JK8nCFbliL-jnQ/exec";

        let globalData = [];

        async function load() {
            const res = await fetch(endpoint);
            globalData = await res.json();
            render(globalData);
        }

        /** CATEGORY DROPDOWN **/
        const categoryBox = document.getElementById("categoryBox");
        const categoryDropdown = document.getElementById("categoryDropdown");

        categoryBox.onclick = () => {
            categoryDropdown.style.display =
                (categoryDropdown.style.display === "block" ? "none" : "block");
        };

        document.addEventListener("click", e => {
            if (!categoryBox.contains(e.target) && !categoryDropdown.contains(e.target)) {
                categoryDropdown.style.display = "none";
            }
        });

        function getSelectedCategories() {
            return Array.from(categoryDropdown.querySelectorAll("input[type=checkbox]:checked"))
                .map(cb => cb.value);
        }

        /** FILTERS **/
        function render(data) {
            const searchText = document.getElementById("searchBox").value.toLowerCase();
            const dateText = document.getElementById("dateInput").value.trim();
            const selectedCategories = getSelectedCategories();

            const tbody = document.getElementById("tableBody");
            tbody.innerHTML = "";

            data.filter(row => {

                if (!row.description.toLowerCase().includes(searchText)) return false;

                if (dateText !== "") {
                    if (!row.date.includes(dateText)) return false;
                }

                if (selectedCategories.length > 0) {
                    if (!selectedCategories.includes(row.category)) return false;
                }

                return true;
            })
                .forEach(r => {
                    const tr = document.createElement("tr");

                    const descHTML = r.link
                        ? `<a href="${r.link}" target="_blank" class="tooltip">${r.description}</a>`
                        : r.description;

                    tr.innerHTML = `
                        <td>${r.srno}</td>
                        <td class="date-cell">${r.date}</td>
                        <td>${descHTML}</td>
                        <td>${r.category}</td>
                    `;
                    tbody.appendChild(tr);
                });
        }

        document.getElementById("searchBox").onkeyup = () => render(globalData);
        document.getElementById("dateInput").onkeyup = () => render(globalData);
        categoryDropdown.onchange = () => render(globalData);

        function clearFilters() {
            document.getElementById("searchBox").value = "";
            document.getElementById("dateInput").value = "";
            categoryDropdown.querySelectorAll("input").forEach(cb => cb.checked = false);
            render(globalData);
        }

        load();
    </script>

</body>

</html>
